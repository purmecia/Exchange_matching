/*
SYMBOL表里放所有symbol的名称
*/
CREATE TABLE IF NOT EXISTS SYMBOL(
SYMBOL_NAME VARCHAR(256) PRIMARY KEY
);

/*
ACCOUNT表存放每个用户的id 以及对应的balance
*/
CREATE TABLE IF NOT EXISTS ACCOUNT(
ACCOUNT_ID BIGINT PRIMARY KEY,
BALANCE DOUBLE PRECISION
);


/*
POSITION表存放每个用户的id 以及该用户拥有的symbol的名字 和对应的数量 (id,symbol)是主键
*/
CREATE TABLE IF NOT EXISTS POSITION(
ACCOUNT_ID BIGINT,
SYMBOL_NAME VARCHAR(256),
AMOUNT DOUBLE PRECISION,
PRIMARY KEY (ACCOUNT_ID, SYMBOL_NAME),
FOREIGN KEY (SYMBOL_NAME) REFERENCES SYMBOL (SYMBOL_NAME) ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ACCOUNT_ID) ON DELETE SET NULL ON UPDATE CASCADE
);


/*
TRANSACTION表存放每一笔order 
transaction_id 是主键 有对应的下单账户id， 下单品种symbol，数量amount（正为买负为卖） ，价格price 以及时间
*/
CREATE TABLE IF NOT EXISTS TRANSACTION(
TRANSACTION_ID BIGSERIAL PRIMARY KEY,
TIME BIGINT,
ACCOUNT_ID BIGINT,
STATUS VARCHAR(256),
SYMBOL_NAME VARCHAR(256),
PRICE DOUBLE PRECISION,
AMOUNT DOUBLE PRECISION,
FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT (ACCOUNT_ID) ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY (SYMBOL_NAME) REFERENCES SYMBOL (SYMBOL_NAME) ON DELETE SET NULL ON UPDATE CASCADE
);

/*
EXECUTION表放每一笔成交的order
存放买卖的transaction id 和时间
以及交易时达成的数量和价格
*/
CREATE TABLE IF NOT EXISTS EXECUTION(
TRANSACTION_BUY_ID BIGINT,
TRANSACTION_SELL_ID BIGINT,
TIME BIGINT,
AMOUNT DOUBLE PRECISION,
PRICE DOUBLE PRECISION,
FOREIGN KEY (TRANSACTION_BUY_ID) REFERENCES TRANSACTION (TRANSACTION_ID) ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY (TRANSACTION_SELL_ID) REFERENCES TRANSACTION (TRANSACTION_ID) ON DELETE SET NULL ON UPDATE CASCADE
);

/*
CANCELATION表放取消掉的订单id 和时间
*/
CREATE TABLE IF NOT EXISTS CANCELATION(
TRANSACTION_ID BIGINT,
TIME BIGINT,
FOREIGN KEY (TRANSACTION_ID) REFERENCES TRANSACTION (TRANSACTION_ID) ON DELETE SET NULL ON UPDATE CASCADE
);